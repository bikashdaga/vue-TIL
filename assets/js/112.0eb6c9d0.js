(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{651:function(s,t,a){"use strict";a.r(t);var n=a(21),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"multer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multer"}},[s._v("#")]),s._v(" multer")]),s._v(" "),a("p",[s._v("multer는 유저가 서버에 업로드한 파일을 받아 인코딩 후 저장해주는 기능을 한다. 사용법은 다음과 같다.")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("npm i multer")])]),s._v(" "),a("li",[s._v("form태그 생성 및 "),a("code",[s._v("enctype")]),s._v(" 애트리뷰트 지정. "),a("code",[s._v('form(method="POST", enctype="multipart/form-data)')])]),s._v(" "),a("li",[s._v("템플릿에 파일을 업로드할 input태그 생성 "),a("code",[s._v('input(type="file", accept="image/*, name="myFile", id="myFile")')]),s._v(" "),a("ul",[a("li",[a("code",[s._v("accept")]),s._v(" 어트리뷰트는 파일 형식을 지정한다. (type/subtype)")])])]),s._v(" "),a("li",[s._v("multer 미들웨어 생성")]),s._v(" "),a("li",[a("strong",[s._v("POST")]),s._v("메서드를 호출하는 라우터에 multer 미들웨어 호출.")]),s._v(" "),a("li",[s._v("미들웨어를 통해 파일을 받을 수 있게 되면 이후 "),a("code",[s._v("req")]),s._v("객체로부터 "),a("code",[s._v("file")]),s._v("이라는 프로퍼티에 접근할 수 있게 된다. ("),a("code",[s._v("req.file")]),s._v(")")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" uploadFiles "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("multer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uploads/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("userRouter\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/edit"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("getEdit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uploadFiles"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("single")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"avatar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" postEdit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//!!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"static-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#static-files"}},[s._v("#")]),s._v(" static files")]),s._v(" "),a("p",[s._v("사실 위의 절차대로만 파일 업로드를 진행하면 화면 단에 제대로 렌더링되지 않는다. 브라우저가 서버에 있는 파일에 알아서 접근할 수가 없으니, "),a("strong",[s._v("라우터를 정의하여 어디로 가야 파일들을 볼 수 있는지 알려줘야 한다.")])]),s._v(" "),a("p",[s._v("정적 파일들에 대한 라우터는 "),a("code",[s._v("express.static()")]),s._v(" 메서드를 활용한다.")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//server.js")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/uploads"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" express"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("static")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uploads"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("/uploads")]),s._v(" 라우터이고, 디렉토리 이름은 uploads라는 의미이다.")]),s._v(" "),a("p",[s._v("라우터 정의 후 템플릿에서 보여주기 위해 "),a("code",[s._v("href")]),s._v(" 어트리뷰트는 "),a("code",[s._v("/")]),s._v("를 붙여줘야한다.")]),s._v(" "),a("div",{staticClass:"language-pug line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-pug"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("img"),a("span",{pre:!0,attrs:{class:"token attributes"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("loggedInUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("avatarUrl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("width")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("height")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")])])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("DB에는 파일을 직접 저장하는 것이 아니라, 파일의 경로를 저장해야한다.")]),s._v(" "),a("div",{staticClass:"language-zsh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{ "_id" : ObjectId("615d357d8688493d150575e9"),\n"name" : "박경준이빈다",\n"email" : "rudwns3927@naver.com",\n"username" : "rudwns3927",\n"password" : "..",\n"location" : "광주",\n"socialOnly" : false,\n"__v" : 0, "avatarUrl" : "uploads/8e477b30c51bc28adea8d9fb45d08292" }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("avatarUrl을 보면 "),a("code",[s._v("uploads/")]),s._v("로 시작되는 경로가 저장되어 있음을 확인할 수 있다. 파일 원본은 클라우드 서버에 저장하면 된다.")])]),s._v(" "),a("p",[s._v("다른 조치없이 위의 과정대로 파일을 관리하는 것은 문제가 있다. 파일을 서버에 저장하므로, 서버 재시작이 이루어지면 메모리의 휘발성으로 인해 파일들이 소멸된다.")])])}),[],!1,null,null,null);t.default=e.exports}}]);